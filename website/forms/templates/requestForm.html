<!DOCTYPE html>
{% extends "base.html" %}
{% load static %}
{% load permissions %}
{% block content %}
<h1>Machine Engineering Request Form</h1>

<!-- Success Message -->
{% if messages %}
<div class="success-messages">
  {% for message in messages %}
    <p>{{ message }}</p>
  {% endfor %}
</div>
{% endif %}

<!-- Requestor's Section -->
<form action="{% url 'forms:submit_request' %}" method="POST" enctype="multipart/form-data" class="form-section">
  {% csrf_token %}
  <fieldset>
    <legend>Request Details</legend>

    <div class="form-group">
      <label for="request_type">Type of Request:</label>
      <select id="request_type" name="request_type" 
        {% if not user|has_perm:"forms.can_submit_request" %}disabled{% endif %} required>
        <option value="project">Project</option>
        <option value="modification">Modification</option>
        <option value="drawing">Drawing</option>
      </select>
    </div>

    <div class="form-group">
      <label for="proposed_title">Proposed Title:</label>
      <input type="text" id="proposed_title" name="proposed_title" 
        {% if not user|has_perm:"forms.can_submit_request" %}disabled{% endif %} required>
    </div>

    <div class="form-group">
      <label for="request_date">Request Date:</label>
      <input type="date" id="request_date" name="request_date" 
        {% if not user|has_perm:"forms.can_submit_request" %}disabled{% endif %} required readonly>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function() {
        let today = new Date().toISOString().split('T')[0];
        document.getElementById('request_date').value = today;
      });
    </script>

    <div class="form-group">
      <label for="user_requirement_specification">User Requirement Specification:</label>
      <textarea id="user_requirement_specification" name="user_requirement_specification" rows="4" 
        {% if not user|has_perm:"forms.can_submit_request" %}disabled{% endif %}></textarea>
    </div>

    <div class="form-group">
      <label for="uploaded_file">Upload File:</label>
      <input type="file" id="uploaded_file" name="uploaded_file" 
        {% if not user|has_perm:"forms.can_submit_request" %}disabled{% endif %} 
        accept=".pdf,.doc,.docx,.jpg,.png,.xlsx">
    </div>

    <div class="form-group">
      <label for="purpose">Purpose:</label>
      <input type="text" id="purpose" name="purpose" 
        {% if not user|has_perm:"forms.can_submit_request" %}disabled{% endif %} required>
    </div>

    <div class="form-group">
      <label for="scope">Scope:</label>
      <input type="text" id="scope" name="scope" 
        {% if not user|has_perm:"forms.can_submit_request" %}disabled{% endif %} required>
    </div>

    <div class="form-group">
      <label for="requested_by">Requested by:</label>
      <input type="text" id="requested_by" name="requested_by" 
        {% if not user|has_perm:"forms.can_submit_request" %}disabled{% endif %} required>
    </div>

    <div class="form-group">
      <button type="submit" 
        {% if not user|has_perm:"forms.can_submit_request" %}disabled{% endif %}>
        Submit Request
      </button>
    </div>
  </fieldset>
</form>
{% endblock %}